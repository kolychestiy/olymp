# Геометрия. Введение

## 0. Базовые принципы (Вещественные числа)

Главная проблема геометрии — **точность**.
*   Компьютер не может точно представить многие вещественные числа (например, $1/3$ или $\sqrt{2}$).
*   **Правило:** Если задачу можно решить в целых числах (координаты целые, операции только $+,-,*$), решайте в целых (тип `long long`).
*   Если нужны вещественные числа, используйте `double` или `long double`.
*   Сравнение чисел никогда не делается через `==`. Используем $\varepsilon$ (EPS).

```cpp
const double EPS = 1e-9;
bool equal(double a, double b) {
    return abs(a - b) < EPS;
}
```

---

## 1. Точка и Вектор

В программировании Точка и Вектор описываются одной и той же структурой, но имеют разный физический смысл.
*   **Точка (Point):** Место в пространстве $(x, y)$.
*   **Вектор (Vector):** Направление и длина. Вектор $\vec{AB} = B - A$. Координаты вектора — это смещение $(x_B - x_A, y_B - y_A)$.

### Основные операции
1.  **Сложение:** Точка + Вектор = Точка. Вектор + Вектор = Вектор.
2.  **Вычитание:** Точка - Точка = Вектор.
3.  **Умножение на число:** Вектор * $k$ = Масштабированный вектор.
4.  **Длина вектора:** $|\vec{a}| = \sqrt{x^2 + y^2}$ (по теореме Пифагора). В коде функция `hypot(x, y)`.

---

## 2. Произведения векторов

Это **фундамент** всей олимпиадной геометрии. Забудьте про уравнения прямых $y = kx + b$, используйте векторные произведения.

### А. Скалярное произведение (Dot Product)
Обозначается: $(\vec{a}, \vec{b})$ или $\vec{a} \cdot \vec{b}$.

**Формула (координаты):**
$$a \cdot b = x_a \cdot x_b + y_a \cdot y_b$$

**Геометрический смысл:**
$$a \cdot b = |a| \cdot |b| \cdot \cos(\alpha)$$
Где $\alpha$ — угол между векторами.

**Зачем нужно:** Определять тип угла.
*   `dot > 0`: Угол острый ($< 90^\circ$).
*   `dot == 0`: Векторы **перпендикулярны** ($90^\circ$).
*   `dot < 0`: Угол тупой ($> 90^\circ$).

### Б. Векторное (косое) произведение (Cross Product)
В 2D геометрии результатом является число (псевдоскаляр), равное $z$-компоненте 3D произведения.
Обозначается: $[\vec{a}, \vec{b}]$ или $\vec{a} \times \vec{b}$.

**Формула (координаты):**
$$a \times b = x_a \cdot y_b - x_b \cdot y_a$$
*(Похоже на определитель матрицы 2x2)*

**Геометрический смысл:**
1.  **Площадь:** Абсолютное значение $|a \times b|$ равно площади параллелограмма, натянутого на векторы $a$ и $b$. (Площадь треугольника = половина от этого).
2.  **Ориентация (Поворот):**
    $$a \times b = |a| \cdot |b| \cdot \sin(\alpha)$$
    (где $\alpha$ — ориентированный угол от $a$ к $b$).

**Зачем нужно:** Определять взаимное расположение.
*   `cross > 0`: Вектор $b$ находится **слева** от вектора $a$ (поворот против часовой стрелки).
*   `cross < 0`: Вектор $b$ находится **справа** от вектора $a$ (поворот по часовой стрелке).
*   `cross == 0`: Векторы **коллинеарны** (лежат на одной прямой).

---

## 3. Прямые, Отрезки, Лучи

### Прямая (Line)
Задается уравнением $Ax + By + C = 0$.
Если даны две точки $P$ и $Q$, коэффициенты вычисляются так:
*   $A = P.y - Q.y$
*   $B = Q.x - P.x$
*   $C = -A \cdot P.x - B \cdot P.y$

*Расстояние от точки $(x_0, y_0)$ до прямой:*
$$Dist = \frac{|Ax_0 + By_0 + C|}{\sqrt{A^2 + B^2}}$$

### Отрезок (Segment)
Задается двумя точками.
**Проверка: лежит ли точка $C$ на отрезке $AB$?**
1.  Она должна лежать на прямой $AB$ $\to$ `cross_product(AB, AC) == 0`.
2.  Она должна лежать "между" $A$ и $B$ $\to$ `dot_product(AC, BC) <= 0` (векторы $AC$ и $BC$ направлены в разные стороны или один из них нулевой).

**Пересечение отрезков $AB$ и $CD$:**
Отрезки пересекаются, если концы одного отрезка лежат по разные стороны от прямой, содержащей другой отрезок (проверяется через знаки косых произведений). + Граничные случаи (наложение на одной прямой).

### Луч (Ray)
Задается точкой начала и направляющим вектором.

---

## 4. Хранение в C++ (Шаблон)

Профессиональная реализация структуры `Point` с перегрузкой операторов.

```cpp
#include <iostream>
#include <cmath>

using namespace std;

// Используем long long, если координаты до 10^9 и не нужны деления/корни.
// Иначе double / long double.
typedef long long ftype; 

struct Point {
    ftype x, y;

    // Конструктор
    Point(ftype _x = 0, ftype _y = 0) : x(_x), y(_y) {}

    // Сложение и вычитание векторов
    Point operator+(const Point& other) const {
        return Point(x + other.x, y + other.y);
    }
    Point operator-(const Point& other) const {
        return Point(x - other.x, y - other.y);
    }
    
    // Умножение на скаляр
    Point operator*(ftype k) const {
        return Point(x * k, y * k);
    }

    // Скалярное произведение (Dot Product)
    ftype operator*(const Point& other) const {
        return x * other.x + y * other.y;
    }

    // Векторное/Косое произведение (Cross Product)
    // В C++ приоритет % такой же как *, но для удобства часто используют функцию
    ftype cross(const Point& other) const {
        return x * other.y - y * other.x;
    }
    
    // Квадрат длины (чтобы не извлекать корень лишний раз)
    ftype lenSq() const {
        return x*x + y*y;
    }
    
    // Длина (вещественная)
    double len() const {
        return hypot(x, y);
    }
};

// Функция для удобства вызова косого произведения (a ^ b)
// Но будьте осторожны с приоритетом операций ^ в C++ (он ниже чем +)
ftype cross_product(Point a, Point b) {
    return a.x * b.y - a.y * b.x;
}

// Ориентированная площадь треугольника ABC
ftype triangle_area_2x(Point a, Point b, Point c) {
    return (b - a).cross(c - a);
}
```

### Важные заметки по реализации:

1.  **Полярный угол:** Часто нужно сортировать точки по углу вокруг какой-то точки. Используйте функцию `atan2(y, x)`, она возвращает угол в радианах от $(-\pi, \pi]$.
2.  **Чтение:**
    ```cpp
    istream& operator>>(istream& in, Point& p) {
        return in >> p.x >> p.y;
    }
    ```
3.  **Приоритет операций:** В выражении `a ^ b + c`, сначала выполнится `+`, потом `^` (xor). Поэтому лучше писать методы `.cross()` или функции `cross(a, b)`, чтобы избежать ошибок.

---

## Шпаргалка: Как решать задачи

1.  **Площадь многоугольника:** Формула шнуровки (Shoelace formula). Сумма косых произведений соседних вершин делить на 2.
    $$S = \frac{1}{2} | \sum_{i=0}^{n-1} (P_i \times P_{i+1}) |$$ (где $P_n = P_0$).
2.  **Слева или справа?** Знак `(B - A).cross(C - A)`.
3.  **Угол?** Используй `dot` для $\cos$ и `cross` для $\sin$. Или `atan2`.
4.  **Сортировка по углу:** Если можно, избегай `atan2` (медленно и double). Используй векторное произведение для сравнения (с проверкой полуплоскостей).